syntax = "proto3";

package tripsphere.chat;

import "google/protobuf/struct.proto";
import "google/protobuf/timestamp.proto";
import "tripsphere/chat/protocol.proto";

option java_multiple_files = true;
option java_package = "org.tripsphere.chat";
option java_outer_classname = "ConversationProto";

message Conversation {
  // ID for the conversation.
  string conversation_id = 1;
  // Time at which the conversation was created.
  google.protobuf.Timestamp created_at = 2;
  // Additional metadata for the conversation.
  google.protobuf.Struct metadata = 3;
}

message ConversationItem {
  oneof content {
    // A2A Task is a snapshot of the stateful task at a point in time.
    Task task = 1;
    // A2A Message is used for immediate, self-contained interactions.
    Message message = 2;
  }
  google.protobuf.Timestamp created_at = 3;
}

service ConversationService {
  rpc CreateConversation(CreateConversationRequest) returns (CreateConversationResponse) {}

  rpc DeleteConversation(DeleteConversationRequest) returns (DeleteConversationResponse) {}

  rpc GetConversation(GetConversationRequest) returns (GetConversationResponse) {}

  rpc UpdateConversation(UpdateConversationRequest) returns (UpdateConversationResponse) {}

  rpc GetConversationItem(GetConversationItemRequest) returns (GetConversationItemResponse) {}

  rpc ListConversationItems(ListConversationItemsRequest) returns (ListConversationItemsResponse) {}

  rpc ExtendConversationItems(ExtendConversationItemsRequest) returns (ExtendConversationItemsResponse) {}
}

message CreateConversationRequest {}

message CreateConversationResponse {
  Conversation conversation = 1;
}

message DeleteConversationRequest {
  string conversation_id = 1;
}

message DeleteConversationResponse {}

message GetConversationRequest {
  string conversation_id = 1;
}

message GetConversationResponse {
  Conversation conversation = 1;
}

message UpdateConversationRequest {
  string conversation_id = 1;
  google.protobuf.Struct metadata = 2;
}

message UpdateConversationResponse {
  // Updated conversation details.
  Conversation conversation = 1;
}

message GetConversationItemRequest {
  string conversation_id = 1;
  string item_id = 2;
}

message GetConversationItemResponse {
  ConversationItem item = 1;
}

message ListConversationItemsRequest {
  string conversation_id = 1;
  // Number of items to return in one page.
  int32 page_size = 2;
  // Base64 encoded item ID returned from previous call.
  string page_token = 3;
  // The order of items, "asc" or "desc", default is "desc".
  string order = 4;
}

message ListConversationItemsResponse {
  repeated ConversationItem items = 1;
  // Base64 encoded item ID for fetching the next page.
  string next_page_token = 2;
  // Total number of items in the conversation.
  int32 total_size = 3;
}

message ExtendConversationItemsRequest {
  string conversation_id = 1;
  repeated ConversationItem items = 2;
}

message ExtendConversationItemsResponse {}