syntax = "proto3";

package tripsphere.itinerary;

import "tripsphere/itinerary/itinerary.proto";

option go_package = "tripsphere/itinerary";
option java_multiple_files = true;
option java_package = "org.tripsphere.itinerary";

service PlanningService {
  // Plan an itinerary (synchronous)
  rpc PlanItinerary(PlanItineraryRequest) returns (PlanItineraryResponse);

  // Plan an itinerary (streaming progress updates)
  rpc PlanItineraryStream(PlanItineraryStreamRequest) returns (stream PlanItineraryStreamResponse);
}

message PlanItineraryRequest {
  string user_id = 1;
  string destination = 2;
  string start_date = 3; // YYYY-MM-DD
  string end_date = 4;
  repeated string interests = 5;
  BudgetLevel budget_level = 6;
  int32 num_travelers = 7;
  map<string, string> preferences = 8;
}

message PlanItineraryStreamRequest {
  string user_id = 1;
  string destination = 2;
  string start_date = 3; // YYYY-MM-DD
  string end_date = 4;
  repeated string interests = 5;
  BudgetLevel budget_level = 6;
  int32 num_travelers = 7;
  map<string, string> preferences = 8;
}

message PlanItineraryResponse {
  Itinerary itinerary = 1;
}

message PlanItineraryStreamResponse {
  int32 progress_percentage = 1; // 0-100
  string status_message = 2; // "Researching destination..."
  PlanningStep current_step = 3;
  Itinerary partial_itinerary = 4; // Optional: partially completed itinerary

  enum PlanningStep {
    PLANNING_STEP_UNSPECIFIED = 0;
    PLANNING_STEP_ANALYZING_PREFERENCES = 1;
    PLANNING_STEP_RESEARCHING_DESTINATION = 2;
    PLANNING_STEP_FINDING_ATTRACTIONS = 3;
    PLANNING_STEP_OPTIMIZING_ROUTE = 4;
    PLANNING_STEP_ADDING_RECOMMENDATIONS = 5;
    PLANNING_STEP_FINALIZING = 6;
  }
}
