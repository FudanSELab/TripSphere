# higress-config.yaml (放在项目根目录)
apiVersion: gateway.higress.io/v1alpha1
kind: Upstream
metadata:
  name: ai-backend  # 自定义名称
spec:
  type: cluster
  endpoints:
    - host: api.zhizengzeng.com  # 原 Base URL 的主机部分 (去掉 https:// 和 /v1)
      port: 443
      weight: 100
  hostRewrite: api.zhizengzeng.com  # 关键！必须与 host 一致
  tls:
    insecureSkipVerify: true  # 仅开发环境使用

---
apiVersion: gateway.higress.io/v1alpha1
kind: Route
metadata:
  name: zhizengzeng-proxy-route
spec:
  gateway: higress-gateway
  match:
    paths:
      - prefix: /v1  # 匹配 /v1 开头的路径 (与 Agent Base URL 一致)
  backend:
    upstream:
      name: ai-backend
  # 关键：保留 /v1 路径前缀 (避免后端路径不匹配)
  pathRewrite:
    pattern: ^/v1/(.*) $ 
    replacement: /v1/ $ 1