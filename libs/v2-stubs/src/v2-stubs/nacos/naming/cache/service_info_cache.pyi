from _typeshed import Incomplete
from typing import Callable
from v2.nacos.common.client_config import ClientConfig as ClientConfig
from v2.nacos.common.constants import Constants as Constants
from v2.nacos.naming.cache.subscribe_manager import SubscribeManager as SubscribeManager
from v2.nacos.naming.model.instance import Instance as Instance
from v2.nacos.naming.model.service import Service as Service
from v2.nacos.naming.util.naming_client_util import get_group_name as get_group_name, get_service_cache_key as get_service_cache_key
from v2.nacos.utils.common_util import get_current_time_millis as get_current_time_millis, to_json_string as to_json_string
from v2.nacos.utils.file_util import read_all_files_in_dir as read_all_files_in_dir, write_to_file as write_to_file

class ServiceInfoCache:
    logger: Incomplete
    cache_dir: Incomplete
    service_info_map: dict[str, Service]
    update_time_map: Incomplete
    lock: Incomplete
    sub_callback_manager: Incomplete
    update_cache_when_empty: Incomplete
    def __init__(self, client_config: ClientConfig) -> None: ...
    async def load_cache_from_disk(self) -> None: ...
    async def process_service_json(self, data: str): ...
    async def process_service(self, service: Service): ...
    async def get_service_info(self, service_name, group_name, clusters) -> Service: ...
    def check_instance_changed(self, old_service: Service | None, new_service: Service): ...
    @staticmethod
    def sort_instances(instances: list[Instance]) -> list[Instance]: ...
    async def register_callback(self, service_name: str, clusters: str, callback_func: Callable): ...
    async def deregister_callback(self, service_name: str, clusters: str, callback_func: Callable): ...
    async def is_subscribed(self, service_name: str, clusters: str) -> bool: ...
